name: ZKEEN dat â†’ MRS

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */6 * * *"

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      GOPATH: ${{ github.workspace }}/.gopath
      GOBIN: ${{ github.workspace }}/.gopath/bin

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: true

      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: "1.21"

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Prepare directories
        run: |
          mkdir -p "${GOPATH}/bin"
          mkdir -p tmp/geoip tmp/geosite 
          mkdir -p rules/geoip rules/geosite
          echo "${GOPATH}/bin" >> $GITHUB_PATH

      - name: Install v2dat tool
        run: |
          set -e
          echo "Installing v2dat..."
          go install github.com/urlesistiana/v2dat@latest
          echo "v2dat installed at:"
          which v2dat

      - name: Install mihomo tool
        run: |
          set -e
          echo "Installing mihomo..."
          go install github.com/metacubex/mihomo@latest
          echo "mihomo installed at:"
          which mihomo
          
          # Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸Ñ convert-ruleset
          echo "Testing mihomo convert-ruleset syntax..."
          echo "test.com" > test_domain.txt
          echo "1.1.1.1" > test_ip.txt
          
          echo "Test 1: mihomo convert-ruleset domain text test_domain.txt test.mrs"
          mihomo convert-ruleset domain text test_domain.txt test1.mrs 2>&1 && echo "âœ“ Success" || echo "âœ— Failed"
          
          echo "Test 2: mihomo convert-ruleset ipcidr text test_ip.txt test2.mrs"
          mihomo convert-ruleset ipcidr text test_ip.txt test2.mrs 2>&1 && echo "âœ“ Success" || echo "âœ— Failed"
          
          echo "Test 3: mihomo convert-ruleset --help"
          mihomo convert-ruleset --help 2>&1 | head -20
          
          rm -f test*.txt test*.mrs

      - name: Download ZKEEN dat files
        run: |
          set -e
          echo "Downloading geoip.dat..."
          curl -fsSL -o tmp/zkeenip.dat "https://github.com/jameszeroX/zkeen-ip/releases/latest/download/zkeenip.dat"
          
          echo "Downloading geosite.dat..."
          curl -fsSL -o tmp/zkeen.dat "https://github.com/jameszeroX/zkeen-domains/releases/latest/download/zkeen.dat"
          
          echo "File sizes:"
          ls -lh tmp/*.dat

      - name: Unpack GeoIP dat file
        run: |
          set -e
          echo "Unpacking geoip.dat..."
          if [ -f tmp/zkeenip.dat ]; then
            v2dat unpack geoip -o tmp/geoip tmp/zkeenip.dat
            echo "Unpacked geoip files:"
            ls -lh tmp/geoip/*.txt 2>/dev/null | head -5 || echo "No .txt files found"
          else
            echo "Error: zkeenip.dat not found!"
            exit 1
          fi

      - name: Unpack GeoSite dat file
        run: |
          set -e
          echo "Unpacking geosite.dat..."
          if [ -f tmp/zkeen.dat ]; then
            v2dat unpack geosite -o tmp/geosite tmp/zkeen.dat
            echo "Unpacked geosite files:"
            ls -lh tmp/geosite/*.txt 2>/dev/null | head -5 || echo "No .txt files found"
          else
            echo "Error: zkeen.dat not found!"
            exit 1
          fi

      - name: Process files and create all formats
        run: |
          set -e
          echo "Processing files - creating TXT, YAML and MRS formats..."
          
          # ÐžÑ‡Ð¸Ñ‰Ð°ÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
          rm -rf rules/geoip/* rules/geosite/* 2>/dev/null || true
          
          # === ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ GeoIP Ñ„Ð°Ð¹Ð»Ñ‹ ===
          echo "=== Processing GeoIP files ==="
          for f in tmp/geoip/zkeenip_*.txt; do
            if [ -f "$f" ]; then
              # Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑ zkeenip_
              name=$(basename "$f" .txt | sed 's/^zkeenip_//')
              echo "Processing GeoIP: $name"
              
              # 1. Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½Ð½Ñ‹Ð¹ TXT Ñ„Ð°Ð¹Ð»
              grep -v '^#' "$f" | grep -v '^$' > "rules/geoip/$name.txt"
              
              if [ -s "rules/geoip/$name.txt" ]; then
                line_count=$(wc -l < "rules/geoip/$name.txt")
                echo "  âœ“ TXT saved ($line_count IP rules)"
                
                # 2. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ YAML Ñ„Ð°Ð¹Ð» Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ payload
                echo "payload:" > "rules/geoip/$name.yaml"
                cat "rules/geoip/$name.txt" | while read line; do
                  echo "  - \"$line\"" >> "rules/geoip/$name.yaml"
                done
                echo "  âœ“ YAML created"
                
                # 3. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ MRS Ñ„Ð°Ð¹Ð» Ñ‡ÐµÑ€ÐµÐ· mihomo convert-ruleset
                echo "  Creating MRS with: mihomo convert-ruleset ipcidr text ..."
                if mihomo convert-ruleset ipcidr text "rules/geoip/$name.txt" "rules/geoip/$name.mrs" 2>&1; then
                  if [ -s "rules/geoip/$name.mrs" ]; then
                    file_size=$(stat -c%s "rules/geoip/$name.mrs")
                    echo "  âœ“ MRS created ($file_size bytes)"
                    
                    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿ÐµÑ€Ð²Ñ‹Ðµ Ð±Ð°Ð¹Ñ‚Ñ‹ Ñ„Ð°Ð¹Ð»Ð°
                    echo "  Checking MRS format..."
                    head -c 50 "rules/geoip/$name.mrs" | xxd | head -1
                  else
                    echo "  âœ— MRS file is empty"
                    rm -f "rules/geoip/$name.mrs"
                  fi
                else
                  echo "  âœ— Failed to create MRS for $name"
                  rm -f "rules/geoip/$name.mrs" 2>/dev/null || true
                fi
              else
                echo "  âš  Empty TXT file, skipping"
              fi
            fi
          done
          
          # === ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ GeoSite Ñ„Ð°Ð¹Ð»Ñ‹ ===
          echo ""
          echo "=== Processing GeoSite files ==="
          for f in tmp/geosite/zkeen_*.txt; do
            if [ -f "$f" ]; then
              # Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑ zkeen_
              name=$(basename "$f" .txt | sed 's/^zkeen_//')
              echo "Processing GeoSite: $name"
              
              # 1. Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½Ð½Ñ‹Ð¹ TXT Ñ„Ð°Ð¹Ð»
              grep -v '^#' "$f" | grep -v '^$' > "rules/geosite/$name.txt"
              
              if [ -s "rules/geosite/$name.txt" ]; then
                line_count=$(wc -l < "rules/geosite/$name.txt")
                echo "  âœ“ TXT saved ($line_count domain rules)"
                
                # 2. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ YAML Ñ„Ð°Ð¹Ð» Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ payload
                echo "payload:" > "rules/geosite/$name.yaml"
                cat "rules/geosite/$name.txt" | while read line; do
                  echo "  - \"$line\"" >> "rules/geosite/$name.yaml"
                done
                echo "  âœ“ YAML created"
                
                # 3. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ MRS Ñ„Ð°Ð¹Ð» Ñ‡ÐµÑ€ÐµÐ· mihomo convert-ruleset
                echo "  Creating MRS with: mihomo convert-ruleset domain text ..."
                if mihomo convert-ruleset domain text "rules/geosite/$name.txt" "rules/geosite/$name.mrs" 2>&1; then
                  if [ -s "rules/geosite/$name.mrs" ]; then
                    file_size=$(stat -c%s "rules/geosite/$name.mrs")
                    echo "  âœ“ MRS created ($file_size bytes)"
                    
                    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿ÐµÑ€Ð²Ñ‹Ðµ Ð±Ð°Ð¹Ñ‚Ñ‹ Ñ„Ð°Ð¹Ð»Ð°
                    echo "  Checking MRS format..."
                    head -c 50 "rules/geosite/$name.mrs" | xxd | head -1
                  else
                    echo "  âœ— MRS file is empty"
                    rm -f "rules/geosite/$name.mrs"
                  fi
                else
                  echo "  âœ— Failed to create MRS for $name"
                  rm -f "rules/geosite/$name.mrs" 2>/dev/null || true
                fi
              else
                echo "  âš  Empty TXT file, skipping"
              fi
            fi
          done
          
          # === Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° ===
          echo ""
          echo "=== Summary ==="
          echo "GeoIP directory:"
          echo "  TXT files:  $(ls rules/geoip/*.txt 2>/dev/null | wc -l)"
          echo "  YAML files: $(ls rules/geoip/*.yaml 2>/dev/null | wc -l)"
          echo "  MRS files:  $(ls rules/geoip/*.mrs 2>/dev/null | wc -l)"
          
          echo ""
          echo "GeoSite directory:"
          echo "  TXT files:  $(ls rules/geosite/*.txt 2>/dev/null | wc -l)"
          echo "  YAML files: $(ls rules/geosite/*.yaml 2>/dev/null | wc -l)"
          echo "  MRS files:  $(ls rules/geosite/*.mrs 2>/dev/null | wc -l)"

      - name: Debug - check why some MRS files work and others don't
        run: |
          set -e
          echo "=== Debug: Analyzing MRS files ==="
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ TXT Ñ„Ð°Ð¹Ð»Ð¾Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ ÑÐ¾Ð·Ð´Ð°ÑŽÑ‚ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ðµ/Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ðµ MRS
          echo "Checking file formats..."
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°
          cat > analyze_mrs.py << 'EOF'
          import os
          import base64
          
          print("=== Analyzing why some MRS files work and others don't ===")
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ GeoIP Ñ„Ð°Ð¹Ð»Ñ‹
          print("\nGeoIP MRS files analysis:")
          geoip_files = []
          for file in os.listdir("rules/geoip"):
              if file.endswith(".mrs"):
                  txt_file = file.replace('.mrs', '.txt')
                  mrs_path = f"rules/geoip/{file}"
                  txt_path = f"rules/geoip/{txt_file}"
                  
                  if os.path.exists(mrs_path) and os.path.exists(txt_path):
                      mrs_size = os.path.getsize(mrs_path)
                      with open(txt_path, 'r') as f:
                          txt_lines = len(f.readlines())
                      
                      # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ MRS
                      with open(mrs_path, 'rb') as f:
                          first_bytes = f.read(10)
                      
                      is_binary = first_bytes.startswith(b'mrs')
                      
                      geoip_files.append({
                          'name': file,
                          'mrs_size': mrs_size,
                          'txt_lines': txt_lines,
                          'is_binary': is_binary,
                          'first_bytes': first_bytes.hex()[:20]
                      })
          
          for f in sorted(geoip_files, key=lambda x: x['name']):
              print(f"{f['name']}: {f['mrs_size']} bytes, {f['txt_lines']} lines, "
                    f"binary: {f['is_binary']}, starts with: {f['first_bytes']}")
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ GeoSite Ñ„Ð°Ð¹Ð»Ñ‹
          print("\nGeoSite MRS files analysis:")
          geosite_files = []
          for file in os.listdir("rules/geosite"):
              if file.endswith(".mrs"):
                  txt_file = file.replace('.mrs', '.txt')
                  mrs_path = f"rules/geosite/{file}"
                  txt_path = f"rules/geosite/{txt_file}"
                  
                  if os.path.exists(mrs_path) and os.path.exists(txt_path):
                      mrs_size = os.path.getsize(mrs_path)
                      with open(txt_path, 'r') as f:
                          txt_lines = len(f.readlines())
                      
                      # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ MRS
                      with open(mrs_path, 'rb') as f:
                          first_bytes = f.read(10)
                      
                      is_binary = first_bytes.startswith(b'mrs')
                      
                      geosite_files.append({
                          'name': file,
                          'mrs_size': mrs_size,
                          'txt_lines': txt_lines,
                          'is_binary': is_binary,
                          'first_bytes': first_bytes.hex()[:20]
                      })
          
          for f in sorted(geosite_files, key=lambda x: x['name']):
              print(f"{f['name']}: {f['mrs_size']} bytes, {f['txt_lines']} lines, "
                    f"binary: {f['is_binary']}, starts with: {f['first_bytes']}")
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ TXT Ñ„Ð°Ð¹Ð»Ð¾Ð²
          print("\n=== Checking problematic TXT files ===")
          print("Files that might have format issues:")
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾Ñ‚ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
          problematic_names = ['akamai', 'amazon', 'cloudflare', 'telegram', 'oracle', 'ru']
          
          for name in problematic_names:
              txt_path = f"rules/geoip/{name}.txt"
              if os.path.exists(txt_path):
                  with open(txt_path, 'r') as f:
                      first_lines = [f.readline().strip() for _ in range(3)]
                  print(f"{name}.txt: {first_lines}")
          
          print("\n=== Conclusion ===")
          print("If only 'other.mrs' works, possible issues:")
          print("1. TXT files might have wrong format (not pure IPs/domains)")
          print("2. mihomo might fail on large files")
          print("3. Some TXT files might have special characters")
          EOF
          
          python3 analyze_mrs.py

      - name: Try alternative MRS creation method
        run: |
          set -e
          echo "=== Trying alternative method for problematic MRS files ==="
          
          # Ð•ÑÐ»Ð¸ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ MRS Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ð»Ð¸ÑÑŒ, Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´
          cat > fix_mrs.py << 'EOF'
          import os
          import base64
          
          print("Fixing problematic MRS files...")
          
          # Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ°ÐºÐ¸Ðµ MRS Ñ„Ð°Ð¹Ð»Ñ‹ Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ð»Ð¸ÑÑŒ
          geoip_missing = []
          for file in os.listdir("rules/geoip"):
              if file.endswith(".txt"):
                  name = file[:-4]
                  mrs_file = f"{name}.mrs"
                  if not os.path.exists(f"rules/geoip/{mrs_file}"):
                      geoip_missing.append(name)
          
          geosite_missing = []
          for file in os.listdir("rules/geosite"):
              if file.endswith(".txt"):
                  name = file[:-4]
                  mrs_file = f"{name}.mrs"
                  if not os.path.exists(f"rules/geosite/{mrs_file}"):
                      geosite_missing.append(name)
          
          print(f"Missing GeoIP MRS: {geoip_missing}")
          print(f"Missing GeoSite MRS: {geosite_missing}")
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð½ÐµÐ´Ð¾ÑÑ‚Ð°ÑŽÑ‰Ð¸Ðµ MRS Ñ„Ð°Ð¹Ð»Ñ‹ Ð² Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ð¾Ð¼ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ
          print("\nCreating missing MRS files in text format...")
          
          for name in geoip_missing:
              txt_path = f"rules/geoip/{name}.txt"
              mrs_path = f"rules/geoip/{name}.mrs"
              
              if os.path.exists(txt_path):
                  with open(txt_path, 'r') as f:
                      content = f.read().strip()
                  
                  if content:
                      encoded = base64.b64encode(content.encode('utf-8')).decode('utf-8')
                      with open(mrs_path, 'w') as f:
                          f.write(f"ipcidr,text,{encoded}")
                      print(f"Created {mrs_path}")
          
          for name in geosite_missing:
              txt_path = f"rules/geosite/{name}.txt"
              mrs_path = f"rules/geosite/{name}.mrs"
              
              if os.path.exists(txt_path):
                  with open(txt_path, 'r') as f:
                      content = f.read().strip()
                  
                  if content:
                      encoded = base64.b64encode(content.encode('utf-8')).decode('utf-8')
                      with open(mrs_path, 'w') as f:
                          f.write(f"domain,text,{encoded}")
                      print(f"Created {mrs_path}")
          
          print("\nAll MRS files should now exist")
          EOF
          
          python3 fix_mrs.py

      - name: Create usage examples
        run: |
          set -e
          echo "Creating usage examples..."
          
          cat > rules/README.md << 'EOF'
          # ZKEEN Rules for Mihomo/Clash Meta
          
          ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð¸Ð· ZKEEN dat Ñ„Ð°Ð¹Ð»Ð¾Ð².
          
          ## ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°
          
          ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð½Ð°Ð±Ð¾Ñ€ Ð¿Ñ€Ð°Ð²Ð¸Ð» Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð² Ñ‚Ñ€ÐµÑ… Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð°Ñ…:
          - `.txt` - Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚
          - `.yaml` - YAML Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ `payload:` 
          - `.mrs` - MRS Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ (Ð´Ð»Ñ rule-providers)
          
          ## ðŸŽ¯ Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð½Ð°Ð±Ð¾Ñ€Ñ‹ Ð¿Ñ€Ð°Ð²Ð¸Ð»
          
          ### GeoIP (IP/CIDR):
          EOF
          
          # Ð¡Ð¿Ð¸ÑÐ¾Ðº GeoIP Ñ„Ð°Ð¹Ð»Ð¾Ð²
          for f in rules/geoip/*.txt; do
            if [ -f "$f" ]; then
              name=$(basename "$f" .txt)
              count=$(wc -l < "$f")
              echo "- **$name** ($count Ð¿Ñ€Ð°Ð²Ð¸Ð»)" >> rules/README.md
            fi
          done
          
          cat >> rules/README.md << 'EOF'
          
          ### GeoSite (Ð´Ð¾Ð¼ÐµÐ½Ñ‹):
          EOF
          
          # Ð¡Ð¿Ð¸ÑÐ¾Ðº GeoSite Ñ„Ð°Ð¹Ð»Ð¾Ð²
          for f in rules/geosite/*.txt; do
            if [ -f "$f" ]; then
              name=$(basename "$f" .txt)
              count=$(wc -l < "$f")
              echo "- **$name** ($count Ð¿Ñ€Ð°Ð²Ð¸Ð»)" >> rules/README.md
            fi
          done
          
          cat >> rules/README.md << 'EOF'
          
          ## ðŸ”§ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ
          
          ### MRS Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ):
          ```yaml
          rule-providers:
            geoip_cn:
              type: http
              behavior: ipcidr
              url: "https://raw.githubusercontent.com/YOUR_USER/YOUR_REPO/main/rules/geoip/cn.mrs"
              interval: 86400
            
            geosite_cn:
              type: http
              behavior: domain
              url: "https://raw.githubusercontent.com/YOUR_USER/YOUR_REPO/main/rules/geosite/cn.mrs"
              interval: 86400
          ```
          
          ### YAML Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚:
          ```yaml
          rule-providers:
            geoip_cn:
              type: http
              behavior: ipcidr
              url: "https://raw.githubusercontent.com/YOUR_USER/YOUR_REPO/main/rules/geoip/cn.yaml"
              interval: 86400
          ```
          
          ## âš™ï¸ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ
          
          ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ÑÑ ÐºÐ°Ð¶Ð´Ñ‹Ðµ 6 Ñ‡Ð°ÑÐ¾Ð².
          
          ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÐµÐµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ: $(date -u +"%Y-%m-%d %H:%M:%S UTC")
          EOF

      - name: Commit all files
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          git add rules/
          
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "chore: update all rule formats [$(date +'%Y-%m-%d %H:%M')]"
            git push
            echo "Changes pushed successfully"
          fi
